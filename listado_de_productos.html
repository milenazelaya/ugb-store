<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .navbar-brand {
            font-weight: 700;
            font-size: 24px;
        }

        .navbar-brand .ugb, .navbar-brand .store {
            position: relative;
        }

        .navbar-brand .ugb::after, .navbar-brand .store::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: white;
        }

        .navbar-brand .ugb {
            color: red;
        }

        .navbar-brand .store {
            color: white;
        }

        .navbar-nav .nav-link {
            color: white;
        }

        .navbar-nav .nav-link.active {
            font-weight: bold;
        }

        .btn-outline-light {
            margin-left: 5px;
        }

        @media (max-width: 991px) {
            .navbar-collapse {
                flex-direction: column;
            }

            .d-flex {
                flex-direction: column;
                align-items: start;
            }

            .form-select, .form-control {
                margin-bottom: 10px;
            }
        }

        body {
            background-color: #f4f4f4;
            font-family: 'Arial', sans-serif;
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .container {
            max-width: 600px;
        }

        #loadingScreen {
    display: none; /* Estará oculto por defecto */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: black;
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}

#loadingScreen i {
    font-size: 50px;
    color: white;
    margin-bottom: 20px;
}

#loadingScreen p {
    color: white;
    font-size: 20px;
}

.table {
    margin-top: 5px; /* Ajusta este valor según tus necesidades */
}

@media (max-width: 768px) { /* Ajusta este valor según tus necesidades */
    td input, td select, td button {
        width: 100%; /* Hace que los campos de entrada y botones ocupen todo el ancho disponible */
        margin-bottom: 5px; /* Añade un pequeño margen inferior para separar los elementos */
    }
}




/* Asegurarse de que la tabla tenga un ancho del 100% */
.table {
    width: 100%;
    margin-top: 5px;
}


.btn-modificar {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-guardar {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .btn-cancelar {
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-select {
    border-color: #252525;
}

       /* Margen a los botones dentro de la tabla */
.table button {
    margin-right: 5px; /* Margen a la derecha */
    margin-bottom: 5px; /* Margen inferior */
}


/* Estilo para las imágenes de los banners */
#bannersTableBody img {
    width: 500px; /* Aumentado de 300px a 500px */
    height: auto;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    margin: 10px 0;
}


/* Estilo para la celda de acciones en la tabla de banners */
#bannersTableBody td:last-child {
    text-align: center;
}

.table-responsive {
    max-height: 500px; /* Ajusta este valor según tus necesidades */
    overflow-y: auto;
}

.preserve-whitespace {
    white-space: pre-line;
}

    </style>
</head>
<body>

    <div id="loadingScreen">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Oh no, parece que no has iniciado sesión. Por favor, inicia sesión.</p>
        <p>Automáticamente te redirigiremos al inicio de sesión. Espere un momento.</p>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid p-0"> <!-- Añade la clase p-0 aquí -->
            <a class="navbar-brand" href="inicioadmin.html">
                <span class="ugb">UGB</span>
                <span class="store">Store</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="listado_de_productos.html">Ver Productos y Banners</a>
                    </li>
                </ul>

               

                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="reservas.html">Reservas</a>
                    </li>
                </ul>

                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="comentario.html">Comentario de productos</a>
                    </li>
                </ul>

                <ul class="navbar-nav ms-auto"> <!-- Nuevo <ul> con ms-auto solo para el menú desplegable -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Cargando...
                        </a>
                        <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="adminDropdown">
                            <li><a class="dropdown-item" href="#" onclick="cerrarSesion()">Cerrar Sesión</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    
    <div id="app"> 
        <h2>Listado de Produtos</h2>
        <div class="table-responsive"> <!-- Añadido contenedor responsivo -->
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Imagen</th>
                        <th>Nombre</th> <!-- Nueva columna para el nombre del producto -->
                        <th>
                            <select v-model="selectedCategory" class="form-select" @change="filterByCategory" aria-label="Seleccionar categoría" style="background-color: #252525; color: white;">
                                <option value="">Categorías</option>
                                <option value="Tecnología">Tecnología</option>
                                <option value="Diseño">Diseño</option>
                                <option value="Leyes">Leyes</option>
                                <option value="Accesorios para computadora y mochilas">Accesorios para computadora y mochilas</option>
                                <option value="Promocionales">Promocionales</option>
                                <option value="Enfermería">Enfermería</option>
                                <option value="Utilería">Utilería</option>
                            </select>
                        </th>
                        <th>Descripción</th>
                        <th>Precio</th>
                        <th>Oferta</th>
                        <th>Popular</th> <!-- Nueva columna para indicar si es popular -->
                        <th>Disponibilidad</th>
                        <th>Stock</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>                  
                    <tr v-for="product in filteredProducts">
                        <td>
                            <img :src="product.imageUrl" alt="Imagen del producto" class="img-fluid" style="max-width: 200px;">
                            <input v-if="product.isEditing" type="file" @change="event => updateImage(event, product)" title="Seleccionar imagen del producto" placeholder="Seleccionar imagen">
                        </td>
                        <td>
                            <span v-if="!product.isEditing">{{ product.name }}</span>
                            <input v-if="product.isEditing" v-model="product.name" type="text" title="Editar nombre del producto" placeholder="Ingresar nombre">
                        </td>
                        <td>
                            <span v-if="!product.isEditing">{{ product.category }}</span>
                            <select v-if="product.isEditing" v-model="product.category" title="Seleccionar categoría del producto">
                                <option v-for="category in categories" :value="category">{{ category }}</option>
                            </select>
                            
                        </td>
                        <td>
                            <span v-if="!product.isEditing" class="preserve-whitespace">{{ product.description }}</span>

                            <textarea v-if="product.isEditing" v-model="product.description" title="Editar descripción del producto" placeholder="Ingresar descripción" rows="3"></textarea>
                        </td>
                        
                        <td>
                            <span v-if="!product.isEditing">{{ product.price }}</span>
                            <input v-if="product.isEditing" v-model="product.price" type="number" title="Editar precio del producto" placeholder="Ingresar precio">
                        </td>
                        <td>
                            <span v-if="!product.isEditing">{{ product.offer > 0 ? product.offer + '%' : 'No tiene oferta' }}</span>
                            <input v-if="product.isEditing" v-model="product.offer" type="number" title="Editar oferta del producto" placeholder="Ingresar oferta">
                        </td>
                        <td>
                            <span v-if="!product.isEditing">{{ product.popular ? 'Sí' : 'No' }}</span>
                            <select v-if="product.isEditing" v-model="product.popularString" title="Indicar si el producto es popular">
                                <option value="true">Sí</option>
                                <option value="false">No</option>
                            </select>
                        </td>
                        
                        <td>
                            <span v-if="!product.isEditing">{{ product.availability }}</span>
                            <select v-if="product.isEditing" v-model="product.availability" title="Seleccionar disponibilidad del producto">
                                <option value="Disponible">Disponible</option>
                                <option value="No disponible">No disponible</option>
                            </select>
                        </td>
                        <td>
                            <span v-if="!product.isEditing">{{ product.stock }}</span>
                            <input v-if="product.isEditing" v-model="product.stock" type="number" title="Editar stock del producto" placeholder="Ingresar stock">
                        </td>
                        
                        <td>
                            <button class="btn btn-danger btn-sm" @click="deleteProduct(product._id)">Eliminar</button>
                            <button class="btn btn-modificar btn-sm" @click="toggleEdit(product)">Modificar</button>
                            <button class="btn btn-guardar btn-sm" v-if="product.isEditing" @click="saveChanges(product)">Guardar</button>
                            <button class="btn btn-cancelar btn-sm" v-if="product.isEditing" @click="cancelEdit(product)">Cancelar</button>
                        </td>
                    </tr>
                </tbody>
                
            </table>
        </div> <!-- Fin del contenedor responsivo -->
    </div>
    
    
    <div class="mt-5">
        <h2>Listado de Banners</h2>
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Imagen del Banner</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="bannersTableBody">
                    <!-- Aquí se mostrarán los banners -->
                </tbody>
            </table>
        </div>
    </div>
    
    

<!-- Carga Vue.js primero -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

<!-- Luego carga Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios@0.21.1/dist/axios.min.js"></script>

<!-- Después carga tu script app.js -->
<script src="app.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM cargado correctamente"); // Log 1

    const loadingScreen = document.getElementById('loadingScreen');
    const isLoggedIn = localStorage.getItem('isLoggedIn');

    if (!isLoggedIn || isLoggedIn !== 'true') {
        loadingScreen.style.display = 'flex'; // Muestra la pantalla de carga
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 3000);
        return;
    } else {
        loadingScreen.style.display = 'none'; // Oculta la pantalla de carga
    }

    const adminData = JSON.parse(localStorage.getItem('adminData'));
    const adminDropdownLink = document.querySelector('#adminDropdown');
    if (adminData && adminData.name) {
        adminDropdownLink.textContent = adminData.name;
    } else {
        adminDropdownLink.textContent = 'Admin';
    }
});

function limpiarFormulario() {
    document.getElementById("productForm").reset();
}

function cerrarSesion() {
    fetch('http://127.0.0.1:3000/logout', {
        method: 'GET',
        credentials: 'include'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            // Limpiar el localStorage al cerrar sesión
            localStorage.removeItem('adminData');
            localStorage.removeItem('isLoggedIn');
            window.location.href = "login.html";
        } else {
            alert('Error al cerrar sesión. Inténtalo de nuevo.');
        }
    })
    .catch(error => {
        console.error('Error al cerrar sesión:', error);
    });
}

function validateForm() {
    const productImage = document.getElementById('productImage');
    const productPrice = document.getElementById('productPrice');
    const productOffer = document.getElementById('productOffer');
    const productStock = document.getElementById('productStock'); // Nuevo campo de stock

    // Validación de la imagen del producto
    if (!productImage.value) {
        alert('Por favor, carga una imagen para el producto.');
        return false;
    }

    // Validación del precio
    if (parseFloat(productPrice.value) <= 0) {
        alert('El precio del producto debe ser un valor positivo.');
        return false;
    }

    // Validación de la oferta
    const offerValue = parseFloat(productOffer.value);
    if (offerValue < 0 || offerValue > 100) {
        alert('La oferta debe estar entre 0 y 100.');
        return false;
    }

    // Validación del stock
    if (parseInt(productStock.value) < 0) {
        alert('El stock del producto no puede ser negativo.');
        return false;
    }

    return true;
}

//*banner
function loadBanners() {
    fetch('http://127.0.0.1:3000/banners', {
        method: 'GET',
        credentials: 'include'
    })
    .then(response => response.json())
    .then(data => {
        displayBanners(data);
    })
    .catch(error => {
        console.error('Error al cargar los banners:', error);
    });
}



function displayBanners(banners) {
    const tableBody = document.getElementById('bannersTableBody');
    tableBody.innerHTML = ''; // Limpiar el contenido anterior

    banners.forEach(banner => {
        const row = document.createElement('tr');

        const imgCell = document.createElement('td');
        const img = document.createElement('img');
        img.src = banner.imageUrl;
        img.style.width = '500px';
        imgCell.appendChild(img);

        const actionsCell = document.createElement('td');
        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Eliminar';
        deleteButton.className = 'btn btn-danger btn-sm';
        deleteButton.addEventListener('click', () => deleteBanner(banner._id)); // Suponiendo que el ID del banner está en banner._id
        actionsCell.appendChild(deleteButton);

        row.appendChild(imgCell);
        row.appendChild(actionsCell);

        tableBody.appendChild(row);
    });
}

function deleteBanner(bannerId) {
    if (!confirm('¿Estás seguro de que deseas eliminar este banner?')) {
        return;
    }

    fetch(`http://127.0.0.1:3000/banners/${bannerId}`, {
        method: 'DELETE',
        credentials: 'include'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            alert('Banner eliminado con éxito.');
            loadBanners(); // Recargar los banners después de eliminar
        } else {
            alert('Error al eliminar el banner. Inténtalo de nuevo.');
        }
    })
    .catch(error => {
        console.error('Error al eliminar el banner:', error);
    });
}

// Llamar a loadBanners() cuando se carga la página
document.addEventListener('DOMContentLoaded', function() {
    loadBanners();
});


</script>
</body>
</html>